
{% extends "base.html" %}
{% block content %}
<div class="projects-container">
  <div class="projects-header">
    <h2>My Projects</h2>
    <button id="openProjectPanel" class="btn-primary">➕ Add Project</button>
  </div>

  <!-- Overlay -->
  <div id="projectPanelOverlay" class="overlay hidden"></div>

  <!-- Add Project Panel -->
  <div id="projectPanel" class="side-panel hidden">
    <div class="panel-header">
      <h3>Create New Project</h3>
      <button id="closeProjectPanel" class="close-btn">✖</button>
    </div>
    <form method="POST" action="{{ url_for('create_project') }}" class="project-form">
      <label for="title">Project Title</label>
      <input type="text" id="title" name="title" required>

      <label for="description">Description</label>
      <textarea id="description" name="description" rows="3"></textarea>

      <button type="submit" class="btn-primary">Create</button>
    </form>
  </div>

  <!-- Project List -->
  <div class="project-list">
    {% if projects %}
      {% for project in projects %}
      <div class="project-card">
        <div class="project-content" onclick="window.location.href='{{ url_for('project_detail', project_id=project.id) }}'">
          <h3>{{ project.title }}</h3>
          <p>{{ project.description or 'No description' }}</p>
        </div>
        <div class="project-actions">
          <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn view-btn">View Tasks</a>
          {% if user.role == 'admin' %}
          <button onclick="deleteProject({{ project.id }})" class="delete-btn">Delete</button>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p>No projects created yet.</p>
    {% endif %}
  </div>
</div>

<style>
/* General layout */
.projects-container { padding: 2rem; }
.projects-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 1.5rem;
}
.btn-primary {
  background: #007bff; color: white; border: none;
  padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer;
}
.btn-primary:hover { background: #0056b3; }

/* Overlay */
.overlay {
  position: fixed; top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.4);
  opacity: 0; visibility: hidden;
  transition: all 0.3s ease; z-index: 1000;
}
.overlay.active { opacity: 1; visibility: visible; }

/* Side Panel */
.side-panel {
  position: fixed; top: 0; right: 0;
  width: 400px; height: 100%;
  background: #fff; box-shadow: -4px 0 12px rgba(0,0,0,0.2);
  transform: translateX(100%); transition: transform 0.3s ease;
  z-index: 1001; padding: 24px; border-top-left-radius: 12px; border-bottom-left-radius: 12px;
}
.side-panel.active { transform: translateX(0); }
.panel-header {
  display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;
}
.close-btn {
  background: none; border: none; font-size: 1.4rem; cursor: pointer; color: #555;
}
.close-btn:hover { color: #000; }

/* Project Cards */
.project-list {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
}
.project-card {
  background: #fff; border-radius: 10px; padding: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: 0.2s;
}
.project-card:hover { transform: translateY(-2px); background: #f9f9f9; }
.project-content { cursor: pointer; }
.project-actions { margin-top: 1rem; display: flex; gap: 10px; }
.view-btn {
  background: #28a745; color: white; border: none;
  padding: 8px 14px; border-radius: 5px; cursor: pointer;
}
.delete-btn {
  background: #dc3545; color: white; border: none;
  padding: 8px 14px; border-radius: 5px; cursor: pointer;
}
.delete-btn:hover { background: #b02a37; }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const openBtn = document.getElementById("openProjectPanel");
  const closeBtn = document.getElementById("closeProjectPanel");
  const panel = document.getElementById("projectPanel");
  const overlay = document.getElementById("projectPanelOverlay");

  function openPanel() {
    panel.classList.add("active");
    overlay.classList.add("active");
  }
  function closePanel() {
    panel.classList.remove("active");
    overlay.classList.remove("active");
  }

  openBtn.addEventListener("click", openPanel);
  closeBtn.addEventListener("click", closePanel);
  overlay.addEventListener("click", closePanel);
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closePanel();
  });
});

async function deleteProject(projectId) {
  if (!confirm("Are you sure you want to delete this project?")) return;
  const res = await fetch(`/delete_project/${projectId}`, { method: "POST" });
  if (res.ok) location.reload();
  else alert("Failed to delete project.");
}
</script>
{% endblock %}
