
{% extends "base.html" %}
{% block content %}

<style>
.admin-wrapper {
    max-width: 1100px;
    margin: auto;
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.admin-project {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    margin-bottom: 28px;
    padding: 16px;
}

.admin-project-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
}

.admin-table th,
.admin-table td {
    padding: 12px 10px;
    border-bottom: 1px solid #e5e7eb;
    font-size: 14px;
    text-align: left;
    vertical-align: middle;
}

.admin-table th {
    background: #f9fafb;
    font-weight: 600;
    color: #374151;
}

.admin-table td {
    color: #111827;
}

/* Column widths ‚Äî THIS fixes alignment */
.admin-table th:nth-child(1),
.admin-table td:nth-child(1) { width: 30%; }

.admin-table th:nth-child(2),
.admin-table td:nth-child(2) { width: 22%; }

.admin-table th:nth-child(3),
.admin-table td:nth-child(3) { width: 16%; }

.admin-table th:nth-child(4),
.admin-table td:nth-child(4) { width: 14%; }

.admin-table th:nth-child(5),
.admin-table td:nth-child(5) { width: 18%; }

/* Status pills */
.status-pill {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
    text-transform: capitalize;
}

.status-todo {
    background: #fee2e2;
    color: #991b1b;
}

.status-in-progress {
    background: #e0e7ff;
    color: #1e40af;
}

.status-done {
    background: #dcfce7;
    color: #166534;
}

.filter-select {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    background: white;
    font-size: 14px;
}
</style>

<div class="admin-wrapper">

    <!-- ================= HEADER ================= -->
    <div class="admin-header">
        <div>
            <h2>Admin Overview</h2>
            <p style="color:#6b7280;">
                View projects and tasks by employee
            </p>
        </div>

        <!-- üîΩ Employee Filter -->
        <form method="get" action="{{ url_for('admin_overview') }}">
            <select name="user_id"
                    class="filter-select"
                    onchange="
                        if (this.value === '') {
                            window.location = '{{ url_for('admin_overview') }}';
                        } else {
                            this.form.submit();
                        }
                    ">
                <option value="">All employees</option>
                {% for emp in employees %}
                    <option value="{{ emp.id }}"
                        {% if selected_user_id == emp.id %}selected{% endif %}>
                        {{ emp.name }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- ================= PROJECTS ================= -->
    {% if projects %}
        {% for block in projects %}
            <div class="admin-project">

                <div class="admin-project-title">
                    üìÅ {{ block.project.title }}
                </div>

                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Assignee</th>
                            <th>Status</th>
                            <th>Priority</th>
                            <th>Due date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in block.tasks %}
                            <tr>
                                <td>{{ t.title }}</td>
                                <td>{{ t.assignee }}</td>
                                <td>
                                    <span class="status-pill status-{{ t.status }}">
                                        {{ t.status }}
                                    </span>
                                </td>
                                <td>{{ t.priority }}</td>
                                <td>
                                    {% if t.due_date %}
                                        {{ t.due_date }}
                                    {% else %}
                                        ‚Äî
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

            </div>
        {% endfor %}
    {% else %}
        <p style="color:#6b7280;">
            No tasks found for this employee.
        </p>
    {% endif %}

</div>

{% endblock %}
