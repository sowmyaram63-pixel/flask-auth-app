
{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">

<div class="settings-container">

  <h1 class="settings-title">Settings</h1>

  <!-- Tabs -->
  <div class="settings-tabs">
    <button class="tab-btn active" data-tab="profile">Profile</button>
    <button class="tab-btn" data-tab="notifications">Notifications</button>
    <button class="tab-btn" data-tab="email">Email Forwarding</button>
    <button class="tab-btn" data-tab="account">Account</button>
    <button class="tab-btn" data-tab="display">Display</button>
  </div>

  <!-- ================= PROFILE TAB ================= -->
  <div class="tab-content active" id="profile">

    <!-- Profile Photo -->
    <form
      method="POST"
      action="/update_avatar"
      enctype="multipart/form-data"
      id="avatarForm"
    >
      <div class="profile-photo-row">

        <img
          src="{{ user.avatar_url or url_for('static', filename='uploads/company_logo.png') }}"
          class="profile-photo"
        >

        <div class="photo-actions">

          <label class="link-btn">
            Upload new photo
            <input
              type="file"
              name="avatar"
              accept="image/*"
              hidden
              onchange="document.getElementById('avatarForm').submit()"
            >
          </label>

          <button
            type="button"
            class="link-btn danger"
            onclick="removeAvatar()"
          >
            Remove photo
          </button>

        </div>
      </div>
    </form>

    <!-- Profile Form -->
    <form method="POST" action="/update_profile" class="profile-form">

      <div class="form-row">
        <div class="form-group">
          <label>Full name *</label>
          <input type="text" name="name" value="{{ user.name or '' }}">
        </div>

        <div class="form-group">
          <label>Pronouns</label>
          <input type="text" name="pronouns" placeholder="e.g. she/her">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Job title</label>
          <input type="text" name="job_title" value="{{ user.job_title or '' }}">
        </div>

        <div class="form-group">
          <label>Department or team</label>
          <input type="text" name="team" value="{{ user.team or '' }}">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Email</label>
          <input type="email" value="{{ user.email }}" disabled>
        </div>

        <div class="form-group">
          <label>Role</label>
          <input type="text" value="{{ user.role|capitalize }}" disabled>
        </div>
      </div>

      <button class="save-btn">Save changes</button>

    </form>
  </div>

  <!-- ================= NOTIFICATIONS TAB ================= -->
  <div class="tab-content" id="notifications">
    <h2>Notifications</h2>

    <label class="toggle-row">
      <input type="checkbox" checked>
      Email when task is assigned
    </label>

    <label class="toggle-row">
      <input type="checkbox" checked>
      Email when task deadline changes
    </label>

    <label class="toggle-row">
      <input type="checkbox">
      Daily morning summary
    </label>
  </div>

  <!-- ================= EMAIL FORWARDING TAB ================= -->
  <div class="tab-content" id="email">
    <h2>Email Forwarding</h2>
    <p>Forward task updates to another email address.</p>

    <input type="email" placeholder="forward@example.com">
    <button class="save-btn">Save</button>
  </div>

  <!-- ================= ACCOUNT TAB ================= -->
  <div class="tab-content" id="account">
    <h2>Account</h2>
    <a href="/change_password" class="link-btn">Change password</a>
  </div>

  <!-- ================= DISPLAY TAB ================= -->
  <div class="tab-content" id="display">
    <h2>Display</h2>

    <label class="toggle-row">
      <input type="checkbox" id="darkModeToggle">
      Dark mode
    </label>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* =========================
     Tabs logic
  ========================== */
  const tabs = document.querySelectorAll(".tab-btn");
  const contents = document.querySelectorAll(".tab-content");

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      contents.forEach(c => c.classList.remove("active"));

      tab.classList.add("active");
      document
        .getElementById(tab.dataset.tab)
        ?.classList.add("active");
    });
  });

});

/* =========================
   REMOVE AVATAR
========================= */
function removeAvatar() {
  if (!confirm("Remove profile photo?")) return;

  fetch("/remove_avatar", { method: "POST" })
    .then(() => location.reload());
}
</script>

{% endblock %}
